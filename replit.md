# Mini AI Pilot - Simulation Dashboard

## Overview
This is a Flask-based web application that provides an interactive dashboard for visualizing vehicle dispatch optimization data. The Mini AI Pilot uses machine learning to prioritize electric vehicle charging based on urgency, demand, and proximity factors.

## Project Purpose
The dashboard allows users to:
- View and filter vehicle dispatch lists based on priority scores
- Visualize key performance indicators (KPIs) for vehicle fleet management
- Analyze priority distribution, SOC (State of Charge) vs priority, and zone composition
- Recompute priority scores using custom weights and hub locations
- Upload custom CSV data for analysis

## Recent Changes
**2025-10-06**: ML Simulation Feature Complete ✅
- **NEW FEATURE:** Run ML simulations directly from web dashboard
- Added RandomForest ML model training (200 estimators) with configurable random seeds
- Implemented three seed options: Fixed (42), Random, Custom value
- ML predictions now drive priority scores (pred_minutes_to_20pct from model output)
- Real-time dashboard refresh after simulation completes
- Performance: MAE ~18-21 min, R² ~0.83-0.89 (exceeds requirements: MAE ≤ 35, R² ≥ 0.55)
- Added scikit-learn dependency for RandomForestRegressor
- Architect-reviewed and verified ✅

**2025-10-06**: Specification Verification Complete ✅
- **VERIFIED:** All client specifications from `docs/` and `reference/` folders matched
- Confirmed priority calculation formula (60% urgency, 25% demand, 15% proximity)
- Verified Haversine distance calculation (R=6371.0 km)
- Confirmed default hub coordinates (Paris: 48.866, 2.400)
- Validated CSV schema compliance (all required columns present)
- Verified Top-50 subset generation (50 vehicles, sorted correctly)
- Created comprehensive VERIFICATION_REPORT.md

**2025-10-06**: Initial Replit setup
- Installed Python 3.11 and all required dependencies (Flask, NumPy, Pandas, Plotly)
- Created .gitignore for Python project
- Configured Flask server workflow on port 5000
- Set up production deployment with Gunicorn (autoscale)
- Application successfully running and verified

## Project Architecture

### Tech Stack
- **Backend**: Flask 3.1.2 (Python web framework)
- **Data Processing**: Pandas 2.3.3, NumPy 2.3.3
- **Machine Learning**: scikit-learn 1.6.1 (RandomForestRegressor)
- **Visualization**: Plotly 6.3.1
- **Production Server**: Gunicorn 23.0.0
- **Frontend**: Bootstrap 5.3.2, custom CSS with dark theme

### Project Structure
```
.
├── app.py                  # Main Flask application
├── templates/
│   └── index.html         # Dashboard HTML template
├── static/
│   └── styles.css         # Custom CSS styles
├── requirements.txt       # Python dependencies
├── dispatch_list.csv      # Vehicle dispatch data
├── top_50_dispatch.csv    # Top 50 priority vehicles
├── synthetic_gbfs.csv     # Synthetic GBFS data
├── docs/                  # Project documentation
└── reference/             # Reference data and guides
```

### Key Features
1. **ML Simulation**: Run RandomForest simulations with configurable seeds (Fixed/Random/Custom)
2. **Dynamic Priority Calculation**: Haversine distance algorithm for hub proximity
3. **Interactive Filters**: Zone, hour, and minimum priority filters
4. **Real-time Visualization**: 4 interactive Plotly charts
5. **CSV Upload**: Support for custom data uploads
6. **Responsive Design**: Mobile-friendly dark theme interface

### Data Flow
1. Load CSV data (dispatch_list, top_50_dispatch, synthetic_gbfs)
2. Calculate priority scores based on:
   - Urgency: Time to reach 20% SOC
   - Demand: Zone demand score
   - Proximity: Distance to hub
3. Render interactive dashboard with KPIs and charts
4. Support real-time recomputation with custom parameters

## Configuration

### Development
- Server runs on `0.0.0.0:5000`
- Debug mode enabled in development
- Workflow: `python app.py`

### Production (Deployment)
- Uses Gunicorn with 2 workers
- Autoscale deployment target
- Command: `gunicorn --bind=0.0.0.0:5000 --reuse-port --workers=2 app:app`

## Data Files
The application expects three CSV files in the project root:
- `dispatch_list.csv`: Full vehicle dispatch list
- `top_50_dispatch.csv`: Top 50 priority vehicles
- `synthetic_gbfs.csv`: Synthetic GBFS (General Bikeshare Feed Specification) data

These files are generated by the Jupyter notebook: `mini_ai_pilot_colab.ipynb`

## Dependencies
All Python dependencies are managed via pip and defined in `requirements.txt`:
- Flask (>=3.0, <4)
- NumPy (>=2.1)
- Pandas (>=2.2.3)
- Plotly (>=5.22)
- scikit-learn (>=1.5.0) - For RandomForest ML model
- Gunicorn (>=21.2) - Linux/macOS only

## Development Notes
- The app uses Haversine formula for distance calculations
- Priority score is normalized and weighted (default: 60% urgency, 25% demand, 15% proximity)
- ML model: RandomForestRegressor with 200 estimators, predicts minutes_to_empty
- Priority calculation uses ML predictions (pred_minutes_to_20pct derived from model output)
- Charts use Plotly dark theme with custom colors matching the UI
- Client-side filtering implemented in JavaScript for performance

## User Preferences
None specified yet.

## Compliance Status
✅ **FULLY COMPLIANT** with client specifications from reference documentation

### Verified Components:
1. ✅ Priority calculation formula matches spec exactly
2. ✅ Haversine distance formula correct (Earth radius = 6371.0 km)
3. ✅ Default hub coordinates match Paris location (48.866, 2.400)
4. ✅ CSV schemas match specifications (all required columns present)
5. ✅ Top-50 subset generated correctly (50 vehicles, descending priority)
6. ✅ Normalization uses min-max scaling with epsilon (1e-9)
7. ✅ Dashboard displays all required KPIs and visualizations
8. ✅ Interactive features working (filters, recompute, upload)

**See VERIFICATION_REPORT.md for detailed compliance analysis**

## Next Steps
- The application is fully functional and ready to use
- Users can upload their own CSV data or use the provided sample data
- All visualizations and filters are working correctly
- Simulation matches all acceptance criteria from client reference docs
